jQuery(function($) {
	
	$('.cmmrm-embed-btn a').click(function(ev) {
		ev.preventDefault();
		var wrapper = $(this).parents('.cmmrm-toolbar').parent();
		var overlay = CMMRM.Utils.overlay(wrapper.find('.cmmrm-route-embed'));
		overlay.find('.cmmrm-route-embed').show();
		overlay.find('.cmmrm-route-embed textarea').click(function() {
			this.select();
		});
		$(".cmmrm-route-embed-copy-btn", overlay).click(function(e) {
			e.preventDefault();
			var wrapper = $(this).parents('.cmmrm-route-embed');
		    wrapper.find("textarea").select();
		    document.execCommand('copy');
		});
	});
	
	$('body').on('click', '.cmmrm-route-editor .cmmrm-osmtiles .dashicons-plus-alt', function() {
		if($('.cmmrm-osmtiles .row').length < 6) {
			var firstrow = $(this).closest('.row').clone();
			firstrow.find('input').val('');
			firstrow.find('.dashicons').removeClass('dashicons-plus-alt').addClass('dashicons-dismiss');
			$(this).closest('.cmmrm-osmtiles').append(firstrow);
		}
	});

	$('body').on('click', '.cmmrm-route-editor .cmmrm-osmtiles .dashicons-dismiss', function() {
		$(this).closest('.row').remove();
	});
	
	$('body').on('click', '.cmmrm-tec-conatiner span', function(e) {
		$(this).closest('.cmmrm-tec-conatiner').find('.cmmrm-tec-conatiner-inner').show();
	});

	$('body').on('click', '.cmmrm-tec-conatiner .cmmrm_tec_cancel', function(e) {
		$(this).closest('.cmmrm-tec-conatiner').find('.cmmrm-tec-conatiner-inner').hide();
	});

	$('body').on('click', '.cmmrm-tec-conatiner .cmmrm_tec_apply', function(e) {
		
		var that = $(this);
		var post_id = that.closest('.cmmrm-tec-conatiner').data('id');
		var event_data = '';
		that.closest('.cmmrm-tec-conatiner').find('.cmmrm-tec-conatiner-inner input[type="checkbox"]:checked').each(function() {
			event_data += ","+this.value;
		});
		event_data = event_data.substring(1);
		
		var data = {
			"action": "cmmrm_apply_events",
			"post_id": post_id,
			"events": event_data,
		};
		that.closest('.cmmrm-tec-conatiner').find('span img').show();
		$.post(CMMRM_Route_Frontend.ajaxurl, data, function(response) {
			that.closest('.cmmrm-tec-conatiner').find('span img').hide();
			location.reload();
		});

	});

});